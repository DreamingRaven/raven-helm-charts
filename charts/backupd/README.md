# backupd

Corvid approved backupd manifests

![Version: 0.7.0](https://img.shields.io/badge/Version-0.7.0-informational?style=flat-square) ![Type: application](https://img.shields.io/badge/Type-application-informational?style=flat-square) ![AppVersion: 0.1.0](https://img.shields.io/badge/AppVersion-0.1.0-informational?style=flat-square)

This chart will provision volsync backupd and restore manifests.
This is to centralize the otherwise repeated backupd and restore manifests, from being ludicrously repetitive.
This chart aims to have reasonable defaults to reduce the amount of customization required.
This chart does not provision the volsync CRDs, this is left to the user, who must install the volsync operator and CRDs.
This chart also does not provision the restic secrets, which necessarily must be generated by the end user.

These manifests will automatically restore from a backupd on volume creation. This means that when a volume is deleted the contents will be restored from the backupd.
This chart makes use of volsyncs volume populator, which sources new volumes from a backupd on volume creation to restore from backupd.

## Installing the Chart

### Install via OCI helm registry

To install the chart with the release name `backupd`, run the following commands.
For a list of all available charts and versions see the [container registry](https://gitlab.com/GeorgeRaven/raven-helm-charts/container_registry)

To pull the latest version without authentication:

```console
helm install backupd oci://registry.gitlab.com/georgeraven/raven-helm-charts/backupd
```

With authentication:

```console
helm registry login registry.gitlab.com -u <USERNAME> -p <GITLAB_TOKEN>
helm install backupd oci://registry.gitlab.com/georgeraven/raven-helm-charts/backupd --version 0.7.0
```

### Install via Helm index.yaml (deprecated method since: 2025-03-24)

To install the chart with the release name `backupd`, run the following commands:

```console
$ helm repo add raven https://gitlab.com/api/v4/projects/55284972/packages/helm/stable
$ helm repo update raven
$ helm install backupd raven/backupd
```

## Values

| Key | Type | Default | Description |
|-----|------|---------|-------------|
| backup.copyMethod | string | `"Snapshot"` |  |
| backup.enabled | bool | `false` |  |
| backup.pruneIntervalDays | int | `1` |  |
| backup.retain.daily | int | `4` |  |
| backup.retain.hourly | int | `5` |  |
| backup.retain.monthly | int | `2` |  |
| backup.retain.weekly | int | `3` |  |
| backup.retain.yearly | int | `1` |  |
| backup.schedule | string | `"0 * * * 1"` |  |
| backup.trigger | object | `{}` |  |
| existingPVC | string | `""` |  |
| existingSecret | string | `""` |  |
| persistence.accessModes[0] | string | `"ReadWriteOnce"` |  |
| persistence.generate | bool | `true` |  |
| persistence.size | string | `"8Gi"` |  |
| restore.asOf | string | `""` |  |
| restore.enabled | bool | `false` |  |
| restore.previous | string | `nil` |  |
| restore.schedule | string | `"1 * * * 1"` |  |
| restore.trigger | string | `nil` |  |

## Changelog

### 0.7.0

This minor patch introduced backwards compatible restore changes. This included being able to select the previous integer, and asOf date so users can select which backup to restore.

No changes are necessary to the values.yaml but if you would like to use the new restore options you need to add `.restore.asOf` or `.restore.previous`. Note this are not populated by the base chart and they should be used mutually exclusively.

```yaml
restore:
  ...
  # define which backup to restore
  asOf: "" # string e.g: "2022-08-10T20:01:03-04:00"
  previous: # int e.g: 2
```

